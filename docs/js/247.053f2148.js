"use strict";(self["webpackChunkvue3_tetris"]=self["webpackChunkvue3_tetris"]||[]).push([[247],{2247:function(t,i,o){o.r(i),o.d(i,{default:function(){return M}});var e=o(3396),n=o(7139);const s=t=>((0,e.dD)("data-v-3abde733"),t=t(),(0,e.Cn)(),t),l={class:"PlayBoardLayerRoot"},a={class:"level"},r={class:"score"},L=s((()=>(0,e._)("br",null,null,-1)));function h(t,i,o,s,h,m){const p=(0,e.up)("Block"),c=(0,e.up)("MinoLayer");return(0,e.wg)(),(0,e.iD)(e.HY,null,[(0,e._)("div",l,[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(t.stageState.wallList,(t=>((0,e.wg)(),(0,e.j4)(p,{key:t.id,class:"BlockElement",x:t.position.x,y:t.position.y,angle:t.angle,color:t.color},null,8,["x","y","angle","color"])))),128)),(0,e.Wm)(c,{onMap:t.getMap,onScore:t.updateScore,onLevel:t.setLevel},null,8,["onMap","onScore","onLevel"])]),(0,e._)("div",a,"Lv."+(0,n.zw)(t.level),1),(0,e._)("div",r,[(0,e.Uk)("SCORE"),L,(0,e.Uk)((0,n.zw)(t.totalScore),1)])],64)}o(7658);var m=o(4870);const p=t=>{const i=`color: ${t.color};transform: translate(${t.x}px, ${t.y}px);`;return(0,e.h)("div",{class:"BlockRoot",style:i})},c=t=>{let i=!1;return(0,e.bv)((()=>{const o=()=>{requestAnimationFrame((()=>{if(i)return;const e=t();e&&o()}))};o()})),(0,e.Jd)((()=>{i=!0})),{}};function u(t,i,o){return i in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}class S{constructor(t=0,i=0){u(this,"x",void 0),u(this,"y",void 0),this.x=t,this.y=i}get length(){return Math.sqrt(this.x**2+this.y**2)}get angle(){const t=t=>t/Math.PI*180;return t(Math.atan2(this.y,this.x))}add(t){return new S(this.x+t.x,this.y+t.y)}sub(t){return new S(this.x-t.x,this.y-t.y)}times(t){return new S(this.x*t,this.y*t)}unit(t=1){const i=this.length;return new S(this.x/i*t,this.y/i*t)}limit(t=1){return this.length<=t?this:this.unit(t)}rotate(t){const i=t=>t*Math.PI/180,o=i(this.angle+t),e=this.length;return new S(Math.cos(o)*e,Math.sin(o)*e)}}class w{}u(w,"BLOCK_SIZE",40),u(w,"NAMES",["T","I","O","L","J","S","Z"]),u(w,"COLORS",{T:"138, 43, 226",I:"0, 255, 255",L:"0, 0, 255",J:"255, 165, 0",O:"255, 255, 0",S:"0, 255, 0",Z:"255, 0, 0"}),u(w,"SHAPE",{T:[new S(0,0),new S(0,-1),new S(-1,0),new S(1,0)],I:[new S(0,0),new S(-1,0),new S(1,0),new S(2,0)],L:[new S(0,0),new S(-1,0),new S(1,0),new S(1,-1)],J:[new S(0,0),new S(-1,-1),new S(-1,0),new S(1,0)],O:[new S(0,0),new S(1,0),new S(0,-1),new S(1,-1)],S:[new S(0,0),new S(-1,0),new S(0,-1),new S(1,-1)],Z:[new S(0,0),new S(-1,-1),new S(0,-1),new S(1,0)]});var O=w;const g=.25;let y=0;const E=()=>O.NAMES[Math.floor(7*Math.random())];class v{constructor(t,i,o,e,n,s){u(this,"id",y++),u(this,"position",new S(0,0)),u(this,"name",E()),u(this,"angle",360*Math.random()),u(this,"vector",new S),u(this,"force",g),u(this,"color",""),u(this,"shape",[]),u(this,"insensitiveTerms",0),this.position=new S(t,i),this.name=o,this.color=s?"rgba("+e+", "+s+")":"rgba("+e+", 1.0)",this.shape=n}update(){const t=new S(0,O.BLOCK_SIZE);this.position=this.position.add(t),this.position.y>20*O.BLOCK_SIZE&&(this.position=new S(this.position.x,20*O.BLOCK_SIZE)),this.position.y<0&&(this.position=new S(this.position.x,0))}drop(){const t=new S(0,O.BLOCK_SIZE);this.position=this.position.add(t),this.position.y>21*O.BLOCK_SIZE&&(this.position=new S(this.position.x,21*O.BLOCK_SIZE))}slideLeft(){this.position=new S(this.position.x-O.BLOCK_SIZE,this.position.y)}slideRight(){this.position=new S(this.position.x+O.BLOCK_SIZE,this.position.y)}slideUp(){this.position=new S(this.position.x,this.position.y-O.BLOCK_SIZE)}setForce(t){this.force=t}resize(t){this.position=new S(this.position.x+t,this.position.y)}}const d={class:"MinoLayerRoot"};function C(t,i,o,n,s,l){const a=(0,e.up)("Block");return(0,e.wg)(),(0,e.iD)("div",d,[((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(t.stageState.ghost,(t=>((0,e.wg)(),(0,e.j4)(a,{key:t.id,class:"BlockElement",x:t.position.x,y:t.position.y,angle:t.angle,color:t.color,scale:t.scale},null,8,["x","y","angle","color","scale"])))),128)),((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(t.stageState.minoList,(t=>((0,e.wg)(),(0,e.j4)(a,{key:t.id,class:"BlockElement",x:t.position.x,y:t.position.y,angle:t.angle,color:t.color,scale:t.scale},null,8,["x","y","angle","color","scale"])))),128)),((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(t.stageState.holdMino,(t=>((0,e.wg)(),(0,e.j4)(a,{key:t.id,class:"BlockElement",x:t.position.x,y:t.position.y,angle:t.angle,color:t.color,scale:t.scale},null,8,["x","y","angle","color","scale"])))),128)),((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(t.stageState.stock,(t=>((0,e.wg)(),(0,e.j4)(a,{key:t.id,class:"BlockElement",x:t.position.x,y:t.position.y,angle:t.angle,color:t.color,scale:t.scale},null,8,["x","y","angle","color","scale"])))),128))])}const B=(t,i)=>{const o=i=>{t?.(i)};return(0,e.bv)((()=>{const t=i??document.body;t.addEventListener("keydown",o)})),(0,e.Ah)((()=>{const t=i??document.body;t.removeEventListener("keydown",o)})),{}};var I=(0,e.aZ)({name:"MinoLayer",components:{Block:p},props:{keyInput:{type:String,default:""}},setup(t,i){let o=(0,m.iH)("");const n=(0,m.qj)({minoList:[],map:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],t:0,healthCheckTime:0,name:JSON.parse(JSON.stringify(O.NAMES)),holdMino:[],stock:[],ghost:[],totalScore:0,ren:0,deleteLineNum:0,level:1});let s=!1,l=!0,a=(0,m.iH)(Math.floor(.5*window.innerWidth)-5*O.BLOCK_SIZE),r=2*O.BLOCK_SIZE;const L=()=>{n.map=JSON.parse(JSON.stringify(new Array(22).fill(new Array(10).fill(0)))),n.minoList.map((t=>{n.map[(t.position.y-r)/O.BLOCK_SIZE+2][(t.position.x-a.value)/O.BLOCK_SIZE]=1}))},h=()=>{n.name.push("T"),n.name.push("I"),n.name.push("O"),n.name.push("L"),n.name.push("J"),n.name.push("S"),n.name.push("Z")},p=()=>{let t=Math.floor(Math.random()*n.name.length);0===n.name.length&&h();const i=n.name[t];return n.name.splice(t,1),i},u=()=>{let t=a.value+14*O.BLOCK_SIZE,i=20*O.BLOCK_SIZE;const o=p(),e=O.COLORS[o],s=JSON.parse(JSON.stringify(O.SHAPE[o]));for(let l=0;l<s.length;l++)n.stock.push(new v(t+s[l].x*O.BLOCK_SIZE,i+s[l].y*O.BLOCK_SIZE,o,e,s))},w=()=>{const t=a.value-5*O.BLOCK_SIZE,i=r+3*O.BLOCK_SIZE;for(let o=0;o<4;o++){let e=n.minoList.length;const s=n.minoList[e-1],l=JSON.parse(JSON.stringify(s.name)),a=O.COLORS[l],r=JSON.parse(JSON.stringify(O.SHAPE[l]));n.holdMino.push(new v(t+r[o].x*O.BLOCK_SIZE,i+r[o].y*O.BLOCK_SIZE,l,a,r)),n.minoList.splice(e-1,1)}if(4!==n.holdMino.length){const t=n.holdMino[0];let i=a.value+4*O.BLOCK_SIZE,o=1*O.BLOCK_SIZE;const e=JSON.parse(JSON.stringify(t.name)),s=O.COLORS[e],l=JSON.parse(JSON.stringify(O.SHAPE[e]));for(let a=0;a<4;a++)n.minoList.push(new v(i+l[a].x*O.BLOCK_SIZE,o+l[a].y*O.BLOCK_SIZE,e,s,l)),n.holdMino.shift()}else g(),y()},g=()=>{let t=a.value+4*O.BLOCK_SIZE,i=1*O.BLOCK_SIZE,o=n.stock[0].name;const e=JSON.parse(JSON.stringify(O.SHAPE[o])),s=O.COLORS[o];u();for(let l=0;l<e.length;l++)n.minoList.push(new v(t+e[l].x*O.BLOCK_SIZE,i+e[l].y*O.BLOCK_SIZE,o,s,e)),n.stock.shift()},y=()=>{n.stock.map(((t,i)=>{t.position=new S(t.position.x,(4+O.SHAPE[t.name][i%4].y+3*Math.floor(i/4))*O.BLOCK_SIZE)}))},E=t=>{let i=t.length;return!(i<4)&&(t[t.length-1].position.y===21*O.BLOCK_SIZE||t[t.length-2].position.y===21*O.BLOCK_SIZE||t[t.length-3].position.y===21*O.BLOCK_SIZE||t[t.length-4].position.y===21*O.BLOCK_SIZE)},d=t=>{let i=t.length;if(i<4)return!1;for(let o=0;o<4;o++)if(1==n.map[(t[i-(o+1)].position.y-r)/O.BLOCK_SIZE+3][(t[i-(o+1)].position.x-a.value)/O.BLOCK_SIZE])return!0;return!1};B((async t=>{if(console.log("KEY:",t.key),o.value=t.key,"ArrowLeft"===o.value&&(Z(),C(),I(),R()),"ArrowRight"===o.value&&(K(),C(),_(),R()),"ArrowDown"===o.value&&(E(n.minoList)||d(n.minoList)||(x(n.minoList),n.t=1,n.totalScore+=5,i.emit("score",n.totalScore))),"ArrowUp"===o.value){while(!E(n.minoList)&&!d(n.minoList))x(n.minoList),n.totalScore+=5;i.emit("score",n.totalScore),s=!0}"x"===o.value&&(await b(),R()),"z"===o.value&&(await H(),R()),"a"===o.value&&l&&(w(),l=!1,s=!0)}));const C=async()=>{let t=0,i=n.minoList.length;return(n.minoList[i-1].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[i-2].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[i-3].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[i-4].position.x>a.value+9*O.BLOCK_SIZE)&&(Z(),t++,C()),(n.minoList[i-1].position.x<a.value||n.minoList[i-2].position.x<a.value||n.minoList[i-3].position.x<a.value||n.minoList[i-4].position.x<a.value)&&(K(),t++,C()),t},I=async()=>{let t=0;const i=[n.minoList[n.minoList.length-4].position,n.minoList[n.minoList.length-3].position,n.minoList[n.minoList.length-2].position,n.minoList[n.minoList.length-1].position];return 1!=n.map[(i[0].y-r)/O.BLOCK_SIZE+2][(i[0].x-a.value)/O.BLOCK_SIZE]&&1!=n.map[(i[1].y-r)/O.BLOCK_SIZE+2][(i[1].x-a.value)/O.BLOCK_SIZE]&&1!=n.map[(i[2].y-r)/O.BLOCK_SIZE+2][(i[2].x-a.value)/O.BLOCK_SIZE]&&1!=n.map[(i[3].y-r)/O.BLOCK_SIZE+2][(i[3].x-a.value)/O.BLOCK_SIZE]||(K(),t++,t+=await I()),t},_=async()=>{let t=0;const i=[n.minoList[n.minoList.length-4].position,n.minoList[n.minoList.length-3].position,n.minoList[n.minoList.length-2].position,n.minoList[n.minoList.length-1].position];return 1!==n.map[(i[0].y-r)/O.BLOCK_SIZE+2][(i[0].x-a.value)/O.BLOCK_SIZE]&&1!==n.map[(i[1].y-r)/O.BLOCK_SIZE+2][(i[1].x-a.value)/O.BLOCK_SIZE]&&1!==n.map[(i[2].y-r)/O.BLOCK_SIZE+2][(i[2].x-a.value)/O.BLOCK_SIZE]&&1!==n.map[(i[3].y-r)/O.BLOCK_SIZE+2][(i[3].x-a.value)/O.BLOCK_SIZE]||(Z(),t++,t+=await _()),t},Z=()=>{let t=n.minoList.length;for(let i=0;i<4;i++)n.minoList[t-(i+1)].slideLeft()},K=()=>{let t=n.minoList.length;for(let i=0;i<4;i++)n.minoList[t-(i+1)].slideRight()},x=t=>{let i=t.length;if(0!=i)for(let o=0;o<4;o++)t[i-(o+1)].drop()},f=()=>{let t=n.minoList.length;if("O"!=n.minoList[t-4].name)for(let i=0;i<4;i++)n.minoList[t-(4-i)].position=new S(n.minoList[t-4].position.x-n.minoList[t-(4-i)].shape[i].y*O.BLOCK_SIZE,n.minoList[t-4].position.y+n.minoList[t-(4-i)].shape[i].x*O.BLOCK_SIZE),n.minoList[t-(4-i)].shape[i]=new S(-1*n.minoList[t-(4-i)].shape[i].y,n.minoList[t-(4-i)].shape[i].x)},M=()=>{let t=n.minoList.length;if("O"!=n.minoList[t-4].name)for(let i=1;i<4;i++)n.minoList[t-(4-i)].position=new S(n.minoList[t-4].position.x+n.minoList[t-(4-i)].shape[i].y*O.BLOCK_SIZE,n.minoList[t-4].position.y-n.minoList[t-(4-i)].shape[i].x*O.BLOCK_SIZE),n.minoList[t-(4-i)].shape[i]=new S(n.minoList[t-(4-i)].shape[i].y,-1*n.minoList[t-(4-i)].shape[i].x)},k=(t,i)=>{let o=n.minoList.length;for(let e=0;e<4;e++)n.minoList[o-(4-e)].position=t[e],n.minoList[o-(4-e)].shape[e]=i[e]},N=t=>"I"===t,J=(t,i,o,e)=>{let s=n.minoList.length;return((N(n.minoList[s-4].name)?i>2:i>1)||n.minoList[s-1].position.x<a.value||n.minoList[s-2].position.x<a.value||n.minoList[s-3].position.x<a.value||n.minoList[s-4].position.x<a.value||n.minoList[s-1].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[s-2].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[s-3].position.x>a.value+9*O.BLOCK_SIZE||n.minoList[s-4].position.x>a.value+9*O.BLOCK_SIZE)&&(k(o,e),!0)},b=async()=>{const t=n.minoList.length;let i=[n.minoList[t-4].position,n.minoList[t-3].position,n.minoList[t-2].position,n.minoList[t-1].position],o=[n.minoList[t-4].shape[0],n.minoList[t-3].shape[1],n.minoList[t-2].shape[2],n.minoList[t-1].shape[3]];if(f(),E(n.minoList))return void k(i,o);const e=await C();let s=await I();J(e,s,i,o)&&f();const l=await _();J(e,l,i,o)},H=async()=>{const t=n.minoList.length;let i=[n.minoList[t-4].position,n.minoList[t-3].position,n.minoList[t-2].position,n.minoList[t-1].position],o=[n.minoList[t-4].shape[0],n.minoList[t-3].shape[1],n.minoList[t-2].shape[2],n.minoList[t-1].shape[3]];if(M(),E(n.minoList))return void k(i,o);const e=await C();let s=await _();J(e,s,i,o)&&M();const l=await I();J(e,l,i,o)},A=()=>{let t=0,i=!1;for(let o=2;o<n.map.length;o++){let e=0;for(let t=0;t<n.map[o].length;t++)e+=n.map[o][t];if(10===e){n.deleteLineNum++,t++,i=!0;for(let t=n.minoList.length-1;t>=0;t--){let i=n.minoList[t].position.y,e=r+(o-2)*O.BLOCK_SIZE;i===e?n.minoList.splice(t,1):i<e&&n.minoList[t].drop()}L(),n.deleteLineNum%5===0&&Math.ceil(n.deleteLineNum/5)<30&&(n.level=Math.ceil(n.deleteLineNum/5)+1)}}i?n.ren++:n.ren=0,n.totalScore+=t*t*100,n.totalScore+=t*t*n.ren*20,t=0},R=()=>{const t=n.minoList.length;n.ghost=JSON.parse(JSON.stringify([]));for(let i=0;i<4;i++){let o=n.minoList[t-(i+1)].position.x,e=n.minoList[t-(i+1)].position.y;const s=n.minoList[t-(i+1)].name,l=JSON.parse(JSON.stringify(n.minoList[t-(i+1)].shape)),a=O.COLORS[s],r="0.3";n.ghost.push(new v(o,e,s,a,l,r))}while(!E(n.ghost)&&!d(n.ghost))x(n.ghost)};for(let e=0;e<4;e++)u();g(),y(),R(),c((()=>1!==n.map[1][4]&&((n.t%(46-Math.floor(1.5*n.level))===0||s)&&(E(n.minoList)||d(n.minoList)?(L(),A(),console.log("REN",n.ren),console.log("SCORE",n.totalScore),z(),g(),y(),R(),l=!0,i.emit("score",n.totalScore)):(x(n.minoList),R()),s&&(s=!1,n.t=0)),n.t++,n.healthCheckTime++,!0)));const z=()=>{i.emit("map",n.map),i.emit("level",n.level)},P=()=>{const t=Math.floor(.5*window.innerWidth)-5*O.BLOCK_SIZE;for(let i=0;i<n.minoList.length;i++)n.minoList[i].resize(t-a.value);for(let i=0;i<n.holdMino.length;i++)n.holdMino[i].resize(t-a.value);for(let i=0;i<n.ghost.length;i++)n.ghost[i].resize(t-a.value);for(let i=0;i<n.stock.length;i++)n.stock[i].resize(t-a.value);a.value=t};return(0,e.bv)((()=>{window.addEventListener("resize",P)})),{baseX:a,drawMino:u,hold:w,stageState:n,mapEmit:z}}}),_=o(89);const Z=(0,_.Z)(I,[["render",C],["__scopeId","data-v-69071696"]]);var K=Z,x=(0,e.aZ)({name:"PlayBoardLayer",components:{Block:p,MinoLayer:K},props:{},setup(t,i){const o=(0,m.qj)({map:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],wallList:[],t:0}),n=t=>{o.map=t};let s=(0,m.iH)(Math.floor(.5*window.innerWidth)-6*O.BLOCK_SIZE),l=(0,m.iH)(Math.floor(.5*window.innerWidth)+5*O.BLOCK_SIZE);const a=()=>{let t=2*O.BLOCK_SIZE,i=22*O.BLOCK_SIZE,e=0;for(let n=0;n<21;n++)o.wallList.push(new v(s.value,t+n*O.BLOCK_SIZE,"wall","128,128,128",[])),o.wallList.push(new v(l.value,t+n*O.BLOCK_SIZE,"wall","128,128,128",[])),e<10&&(o.wallList.push(new v(s.value+(e+1)*O.BLOCK_SIZE,i,"wall","128, 128, 128",[])),e++)};let r=(0,m.iH)(0);const L=t=>{r.value=t};let h=(0,m.iH)(1);const p=t=>{h.value=t};a(),console.log("Game Start"),c((()=>1!==o.map[1][4]||(console.log("Game Over"),i.emit("ending",!0),i.emit("score",r.value),!1)));const u=()=>{const t=Math.floor(.5*window.innerWidth)-6*O.BLOCK_SIZE;for(let i=0;i<o.wallList.length;i++)o.wallList[i].resize(t-s.value);s.value=t};return(0,e.bv)((()=>{window.addEventListener("resize",u)})),{baseX1:s,baseX2:l,stageState:o,getMap:n,totalScore:r,updateScore:L,level:h,setLevel:p}}});const f=(0,_.Z)(x,[["render",h],["__scopeId","data-v-3abde733"]]);var M=f}}]);
//# sourceMappingURL=247.053f2148.js.map